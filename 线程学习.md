# 线程
## 线程学习的重要性
我们日常的开发工作中，透彻地理解和熟练地运用多线程技术对于每个开发人员来讲，其重要性不言而喻，因为几乎在任何一个稍微复杂一点的项目我们都需要使用多线程技术完成一些并发的操作。特别是随着多核处理器的发展，要想发挥多处理器系统的强大计算能力，熟练地掌握多线程的应用技巧变得十分有必要。  

    对于进程和线程的浅薄认识， 一般来讲，一个运行中的应用程序可以看成是一个进程，那如果在电脑或手机上开启了多个应用程序的话，则系统需要开启多个进程执行多任务的操作。而对于线程概念的讨论则通常是在应用程序(进程上)层次上，举个例子来讲，我们在手机上使用宅男神器快播时，可以边看片边下载，即使同时下载多部X片，也毫不耽误我们看片的节奏。那作为程序员我们从实现角度来分析，上述功能该用什么技术实现呢？很显然，让人第一想起的当然是--多线程。通过开启多个子线程进行协同的操作来完成多个任务的下载，使得不影响我们包括看片的其它操作。  
`那从较为专业的操作系统技术层面看，进程和线程之间到底有什么关系呢？它们之前有什么实质性的区别？`

## 概念
线程是程序内部的一个顺序代码流，它是CPU调度资源的最基本单位。  
每个线程中的内容  

| 每个线程中的内容        |
| --------   |
|程序计数器|
|寄存器|
|堆栈|
|状态|

其中，程序计数器用来记录接着要执行哪一条指令。寄存器用来保存当前的工作变量，堆栈用来记录执行的历史。  

### 线程的状态
 线程从创建、运行到结束总是处于下面五个状态之一：新建状态、就绪状态、运行状态、阻塞状态及死亡状态。
* 新建状态(New)： 
        当用new操作符创建一个线程时， 例如new Thread(r)，线程还没有开始运行，此时线程处在新建状态。 当一个线程处于新生状态时，程序还没有开始运行线程中的代码

* 就绪状态(Runnable)

        一个新创建的线程并不自动开始运行，要执行线程，必须调用线程的start()方法。当线程对象调用start()方法即启动了线程，start()方法创建线程运行的系统资源，并调度线程运行run()方法。当start()方法返回后，线程就处于就绪状态。

        处于就绪状态的线程并不一定立即运行run()方法，线程还必须同其他线程竞争CPU时间，只有获得CPU时间才可以运行线程。因为在单CPU的计算机系统中，不可能同时运行多个线程，一个时刻仅有一个线程处于运行状态。因此此时可能有多个线程处于就绪状态。对多个处于就绪状态的线程是由Java运行时系统的线程调度程序(thread scheduler)来调度的。

* 运行状态(Running)

        当线程获得CPU时间后，它才进入运行状态，真正开始执行run()方法.

*  阻塞状态(Blocked)

        线程运行过程中，可能由于各种原因进入阻塞状态:
        1>线程通过调用sleep方法进入睡眠状态；
        2>线程调用一个在I/O上被阻塞的操作，即该操作在输入输出操作完成之前不会返回到它的调用者；
        3>线程试图得到一个锁，而该锁正被其他线程持有；
        4>线程在等待某个触发条件；
        ......           

        所谓阻塞状态是正在运行的线程没有运行结束，暂时让出CPU，这时其他处于就绪状态的线程就可以获得CPU时间，进入运行状态。
* 死亡状态(Dead)

        有两个原因会导致线程死亡：
        1) run方法正常退出而自然死亡，
        2) 一个未捕获的异常终止了run方法而使线程猝死。
        为了确定线程在当前是否存活着（就是要么是可运行的，要么是被阻塞了），需要使用isAlive方法。如果是可运行或被阻塞，这个方法返回true； 如果线程仍旧是new状态且不是可运行的， 或者线程死亡了，则返回false.


## 进程与线程的关系：
* 线程并不能独立地执行，它必须依附在一个运行的应用程序上(即进程上)，进程至少包含一个线程且可以包含多个线程，而线程只能依附于一个进程上；
* 进程是操作系统资源管理的实体，而线程是进程的实体。  
`注意：当多线程进程在单cpu系统中运行的时候，线程轮流执行（线程是cpu调度资源的最基本的单位的理解）`     



##  线程与进程的区别：
   当操作系统分配给进程资源后，同属于一个进程的多个线程之间可以相互共享进程中的内存资源，原因是线程没有自己独立的内存资源，它只有自己的执行堆栈和局部变量。由于各个线程都可以用来访问进程空间的每一个内存地址，所以一个线程可以读写甚至完全清除另一个线程的堆栈。即线程之间是没有保护作用的。除了共享地址空间外，进程中的线程还共享打开同一个文件集，子进程，报警，以及相关信号。而多个进程之间每个进程都拥有自己的一整套变量，即每个进程都拥有独立的内存单元。这就使得多线程之间的通信比多进程之间的通信更加容易和高效。
   举一个简单的例子，如果一个线程打开了一个文件，则该文件对于进程中其它的线程都是可见的，这些线程也可以对该文件进行读写。
   
## 线程的使用
在描述了什么是线程之后，现在应该解释人们需要线程的原因了。人们需要多线程的原因是对于许多应用而言，同时发生着多种活动，其中某一些活动会随着时间的进展而被阻塞，通过将这些应用分解成可以准并行运行的多个顺序线程，程序设计模型会变得更简单。有了多线程之后，我们才可以实现并行共享同一个地址空间，和所有可用数据的能力。对于大多数应用而言，这种能力是必须要有的。而这正是多进程不能胜任此类工作的原因（因为进程具有不同的地址空间）

